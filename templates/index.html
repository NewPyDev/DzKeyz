{% extends "base.html" %}

{% block title %}{{ config.STORE_NAME }} - Premium Digital Products{% endblock %}
{% block description %}Discover premium digital products with instant delivery. Software, licenses, and digital content at unbeatable prices.{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <h1 class="hero-title fade-in-up">{{ config.STORE_NAME }}</h1>
                <p class="hero-subtitle fade-in-up">Premium digital products with instant delivery. Secure, reliable, and trusted by thousands of customers worldwide.</p>
                <div class="fade-in-up">
                    <a href="#products" class="btn btn-light btn-lg me-3">
                        <i class="bi bi-grid me-2"></i>Browse Products
                    </a>
                    <a href="#contact" class="btn btn-outline-light btn-lg">
                        <i class="bi bi-envelope me-2"></i>Contact Us
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Trust Badges -->
<section class="trust-badges">
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="trust-badge">
                    <div class="trust-badge-icon">
                        <i class="bi bi-shield-check fs-4"></i>
                    </div>
                    <h6 class="fw-semibold">SSL Secured</h6>
                    <p class="text-muted small mb-0">Your data is protected with enterprise-grade encryption</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="trust-badge">
                    <div class="trust-badge-icon">
                        <i class="bi bi-lightning-charge fs-4"></i>
                    </div>
                    <h6 class="fw-semibold">Instant Delivery</h6>
                    <p class="text-muted small mb-0">Get your digital products delivered within minutes</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="trust-badge">
                    <div class="trust-badge-icon">
                        <i class="bi bi-headset fs-4"></i>
                    </div>
                    <h6 class="fw-semibold">24/7 Support</h6>
                    <p class="text-muted small mb-0">Professional support via Telegram and email</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Products Section -->
<section id="products" class="py-5">
    <div class="container">
        <div class="row mb-5">
            <div class="col-12 text-center">
                <h2 class="fw-bold mb-3">Our Digital Products</h2>
                <p class="text-muted lead">Discover our collection of premium digital products</p>
            </div>
        </div>
        
        <!-- Smart Search Bar -->
        <div class="row justify-content-center mb-5">
            <div class="col-lg-8 col-md-10">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <div class="input-group input-group-lg">
                            <span class="input-group-text bg-primary text-white">
                                <i class="bi bi-search"></i>
                            </span>
                            <input type="text" id="searchBox" class="form-control" 
                                   placeholder="Search for products..." 
                                   autocomplete="off">
                            <button class="btn btn-outline-secondary" type="button" id="clearSearch">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Search Results Container -->
        <div id="searchResults" class="mb-4" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0"><i class="bi bi-search me-2"></i>Search Results</h5>
                <button class="btn btn-sm btn-outline-primary" onclick="showAllProducts()">
                    <i class="bi bi-grid me-1"></i>Show All Products
                </button>
            </div>
            <div id="searchResultsContent"></div>
        </div>
        
        <!-- Category Filter -->
        {% if categories %}
        <div class="row justify-content-center mb-4">
            <div class="col-lg-10">
                <div class="card">
                    <div class="card-body">
                        <h6 class="card-title mb-3">
                            <i class="bi bi-funnel me-2"></i>Filter by Category
                        </h6>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-outline-primary btn-sm category-filter active" data-category="all">
                                <i class="bi bi-grid me-1"></i>All Products
                            </button>
                            {% for category in categories %}
                            <button class="btn btn-outline-secondary btn-sm category-filter" data-category="{{ category.id }}">
                                {% if category.icon %}<i class="{{ category.icon }} me-1"></i>{% endif %}
                                {{ category.name }}
                            </button>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Bundles Section -->
        {% if bundles %}
        <div class="mb-5">
            <div class="text-center mb-4">
                <h3 class="fw-bold">
                    <i class="bi bi-box-seam me-2"></i>Special Bundles
                </h3>
                <p class="text-muted">Save money with our curated product bundles</p>
            </div>
            <div class="row g-4 mb-5">
                {% for bundle in bundles %}
                <div class="col-lg-6">
                    <div class="card bundle-card h-100 border-primary">
                        <div class="card-header bg-primary text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">
                                    <i class="bi bi-box-seam me-2"></i>{{ bundle.name }}
                                </h5>
                                <span class="badge bg-warning text-dark">
                                    Save {{ "{:,.0f}".format(bundle.savings) }} DZD
                                </span>
                            </div>
                        </div>
                        {% if bundle.main_image %}
                        <img src="{{ bundle.main_image }}" class="card-img-top" alt="{{ bundle.name }}" style="height: 200px; object-fit: cover;">
                        {% endif %}
                        <div class="card-body">
                            {% if bundle.description %}
                            <p class="card-text">{{ bundle.description }}</p>
                            {% endif %}
                            
                            <div class="pricing-info mb-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="text-muted text-decoration-line-through">{{ "{:,.0f}".format(bundle.original_price) }} DZD</span>
                                        <div class="h4 text-primary mb-0">{{ "{:,.0f}".format(bundle.final_price) }} DZD</div>
                                    </div>
                                    <div class="text-end">
                                        <small class="text-success">
                                            <i class="bi bi-arrow-down me-1"></i>
                                            {{ "{:.0f}".format((bundle.savings / bundle.original_price * 100) if bundle.original_price > 0 else 0) }}% OFF
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <a href="/buy/bundle/{{ bundle.id }}" class="btn btn-primary w-100">
                                <i class="bi bi-cart-plus me-2"></i>Buy Bundle
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if products %}
        <div class="text-center mb-4">
            <h3 class="fw-bold">Individual Products</h3>
            <p class="text-muted">Browse our complete collection of digital products</p>
        </div>
        <div class="row g-4" id="productsContainer">
            {% for product in products %}
            <div class="col-lg-4 col-md-6">
                <div class="card product-card h-100">
                    <a href="{{ url_for('product_details', product_id=product.id) }}" class="text-decoration-none">
                        <div class="product-image">
                            {% if product.main_image %}
                                <img src="{{ product.main_image }}" alt="{{ product.name }}" class="card-img-top" style="height: 200px; object-fit: cover;">
                            {% else %}
                                <div class="d-flex align-items-center justify-content-center bg-light" style="height: 200px;">
                                    {% if product.type == 'key' %}
                                        <i class="bi bi-key-fill text-primary" style="font-size: 3rem;"></i>
                                    {% else %}
                                        <i class="bi bi-file-earmark-arrow-down text-primary" style="font-size: 3rem;"></i>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </a>
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title fw-semibold">
                                <a href="{{ url_for('product_details', product_id=product.id) }}" class="text-decoration-none text-dark">
                                    {{ product.name }}
                                </a>
                            </h5>
                            <span class="badge bg-{{ 'primary' if product.type == 'key' else 'success' }} ms-2">
                                {{ 'License Key' if product.type == 'key' else 'Digital File' }}
                            </span>
                        </div>
                        
                        <!-- Category and Tags -->
                        <div class="mb-2">
                            {% if product.category_name %}
                                <span class="badge bg-secondary me-1">
                                    {% if product.category_icon %}<i class="{{ product.category_icon }} me-1"></i>{% endif %}
                                    {{ product.category_name }}
                                </span>
                            {% endif %}
                            {% if product.is_featured %}
                                <span class="badge bg-warning text-dark me-1">
                                    <i class="bi bi-star me-1"></i>Featured
                                </span>
                            {% endif %}
                            {% for tag in product.tags %}
                                <span class="badge me-1" style="background-color: {{ tag.color }}; color: white;">
                                    {{ tag.name }}
                                </span>
                            {% endfor %}
                        </div>
                        
                        {% if product.description %}
                        <p class="card-text text-muted flex-grow-1">{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>
                        {% endif %}
                        
                        <div class="mt-auto">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <div class="product-price">{{ "{:,.0f}".format(product.price_dzd) }} DZD</div>
                                {% if product.type == 'key' %}
                                    {% if product.stock_count > 0 %}
                                        <small class="text-success">
                                            <i class="bi bi-check-circle me-1"></i>{{ product.stock_count }} available
                                        </small>
                                    {% else %}
                                        <small class="text-danger">
                                            <i class="bi bi-x-circle me-1"></i>Out of stock
                                        </small>
                                    {% endif %}
                                {% else %}
                                    <small class="text-success">
                                        <i class="bi bi-infinity me-1"></i>Digital copies
                                    </small>
                                {% endif %}
                            </div>
                            
                            <div class="d-flex gap-2">
                                <a href="{{ url_for('product_details', product_id=product.id) }}" class="btn btn-outline-primary flex-fill">
                                    <i class="bi bi-eye me-2"></i>View Details
                                </a>
                                {% if product.type == 'file' or product.stock_count > 0 %}
                                    <a href="{{ url_for('buy_product', product_id=product.id) }}" class="btn btn-primary flex-fill">
                                        <i class="bi bi-cart-plus me-2"></i>Buy Now
                                    </a>
                                {% else %}
                                    <button class="btn btn-secondary flex-fill" disabled>
                                        <i class="bi bi-x-circle me-2"></i>Out of Stock
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="row">
            <div class="col-12">
                <div class="text-center py-5">
                    <div class="mb-4">
                        <i class="bi bi-shop text-muted" style="font-size: 4rem;"></i>
                    </div>
                    <h3 class="fw-semibold text-muted">No Products Available</h3>
                    <p class="text-muted">We're working on adding amazing digital products. Check back soon!</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Features Section -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center mb-5">
                <h2 class="fw-bold">Why Choose Us?</h2>
                <p class="text-muted lead">We provide the best digital shopping experience</p>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-md-6 col-lg-3">
                <div class="text-center">
                    <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="bi bi-shield-check fs-4"></i>
                    </div>
                    <h5 class="fw-semibold">Secure Payments</h5>
                    <p class="text-muted small">All transactions are secured with SSL encryption</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="text-center">
                    <div class="bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="bi bi-lightning-charge fs-4"></i>
                    </div>
                    <h5 class="fw-semibold">Instant Delivery</h5>
                    <p class="text-muted small">Get your products delivered within minutes of purchase</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="text-center">
                    <div class="bg-info text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="bi bi-award fs-4"></i>
                    </div>
                    <h5 class="fw-semibold">Premium Quality</h5>
                    <p class="text-muted small">Only the highest quality digital products</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="text-center">
                    <div class="bg-warning text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 64px; height: 64px;">
                        <i class="bi bi-headset fs-4"></i>
                    </div>
                    <h5 class="fw-semibold">Expert Support</h5>
                    <p class="text-muted small">Professional customer support when you need it</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Section -->
<section id="contact" class="py-5 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Section Header -->
                <div class="text-center mb-5">
                    <h2 class="fw-bold mb-3">Get in Touch</h2>
                    <p class="text-muted lead">Have questions? Need support? We're here to help you!</p>
                </div>
                
                <div class="row g-5">
                    <!-- Contact Form -->
                    <div class="col-lg-7">
                        <div class="card shadow-sm border-0">
                            <div class="card-body p-4">
                                <h4 class="fw-semibold mb-4">
                                    <i class="bi bi-envelope-paper me-2 text-primary"></i>Send us a Message
                                </h4>
                                
                                <!-- Success/Error Messages -->
                                <div id="contactAlert" class="alert d-none" role="alert"></div>
                                
                                <form id="contactForm" enctype="multipart/form-data">
                                    <div class="row g-3">
                                        <!-- Name Field -->
                                        <div class="col-md-6">
                                            <label for="contactName" class="form-label fw-semibold">
                                                <i class="bi bi-person me-1"></i>Full Name
                                            </label>
                                            <input type="text" class="form-control" id="contactName" name="name" 
                                                   placeholder="Enter your full name" required>
                                        </div>
                                        
                                        <!-- Email Field -->
                                        <div class="col-md-6">
                                            <label for="contactEmail" class="form-label fw-semibold">
                                                <i class="bi bi-envelope me-1"></i>Email Address
                                            </label>
                                            <input type="email" class="form-control" id="contactEmail" name="email" 
                                                   placeholder="your.email@example.com" required>
                                        </div>
                                        
                                        <!-- Subject Dropdown -->
                                        <div class="col-12">
                                            <label for="contactSubject" class="form-label fw-semibold">
                                                <i class="bi bi-tag me-1"></i>Subject
                                            </label>
                                            <select class="form-select" id="contactSubject" name="subject" required>
                                                <option value="">Choose a subject...</option>
                                                <option value="Support">üõ†Ô∏è Support</option>
                                                <option value="Order Issue">üì¶ Order Issue</option>
                                                <option value="Collaboration">ü§ù Collaboration</option>
                                                <option value="Other">üí¨ Other</option>
                                            </select>
                                        </div>
                                        
                                        <!-- Message Field -->
                                        <div class="col-12">
                                            <label for="contactMessage" class="form-label fw-semibold">
                                                <i class="bi bi-chat-text me-1"></i>Message
                                            </label>
                                            <textarea class="form-control" id="contactMessage" name="message" rows="5" 
                                                      placeholder="Tell us how we can help you..." required></textarea>
                                        </div>
                                        
                                        <!-- File Upload -->
                                        <div class="col-12">
                                            <label for="contactAttachment" class="form-label fw-semibold">
                                                <i class="bi bi-paperclip me-1"></i>Attachment (Optional)
                                            </label>
                                            <input type="file" class="form-control" id="contactAttachment" name="attachment" 
                                                   accept=".jpg,.jpeg,.png,.pdf,.doc,.docx,.txt">
                                            <div class="form-text">
                                                <i class="bi bi-info-circle me-1"></i>
                                                Upload screenshots, documents, or any relevant files (Max 16MB)
                                            </div>
                                        </div>
                                        
                                        <!-- Submit Button -->
                                        <div class="col-12">
                                            <button type="submit" class="btn btn-primary btn-lg w-100" id="submitBtn">
                                                <i class="bi bi-send me-2"></i>Send Message
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Contact Information -->
                    <div class="col-lg-5">
                        <div class="card shadow-sm border-0 h-100">
                            <div class="card-body p-4">
                                <h4 class="fw-semibold mb-4">
                                    <i class="bi bi-info-circle me-2 text-success"></i>Contact Information
                                </h4>
                                
                                <div class="contact-info-list">
                                    <!-- Email -->
                                    <div class="contact-info-item mb-4">
                                        <div class="d-flex align-items-center">
                                            <div class="contact-icon">
                                                <i class="bi bi-envelope-fill text-primary"></i>
                                            </div>
                                            <div class="contact-details">
                                                <h6 class="fw-semibold mb-1">Email Support</h6>
                                                <p class="text-muted mb-0">
                                                    <a href="mailto:{{ config.get('CONTACT_EMAIL', 'support@yourdomain.com') }}" class="text-decoration-none">
                                                        {{ config.get('CONTACT_EMAIL', 'support@yourdomain.com') }}
                                                    </a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Telegram -->
                                    <div class="contact-info-item mb-4">
                                        <div class="d-flex align-items-center">
                                            <div class="contact-icon">
                                                <i class="bi bi-telegram text-info"></i>
                                            </div>
                                            <div class="contact-details">
                                                <h6 class="fw-semibold mb-1">Telegram Chat</h6>
                                                <p class="text-muted mb-0">
                                                    <a href="{{ config.get('TELEGRAM_LINK', 'https://t.me/StockilyBot') }}" target="_blank" rel="noopener" class="text-decoration-none">
                                                        @StockilyBot
                                                    </a>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Response Time -->
                                    <div class="contact-info-item mb-4">
                                        <div class="d-flex align-items-center">
                                            <div class="contact-icon">
                                                <i class="bi bi-clock-fill text-warning"></i>
                                            </div>
                                            <div class="contact-details">
                                                <h6 class="fw-semibold mb-1">Response Time</h6>
                                                <p class="text-muted mb-0">Within 24 hours</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Quick Actions -->
                                <div class="mt-4 pt-4 border-top">
                                    <h6 class="fw-semibold mb-3">Quick Actions</h6>
                                    <div class="d-grid gap-2">
                                        <a href="{{ config.get('TELEGRAM_LINK', 'https://t.me/StockilyBot') }}" target="_blank" rel="noopener" 
                                           class="btn btn-outline-info btn-sm">
                                            <i class="bi bi-telegram me-2"></i>Chat on Telegram
                                        </a>
                                        <a href="mailto:{{ config.get('CONTACT_EMAIL', 'support@yourdomain.com') }}" 
                                           class="btn btn-outline-primary btn-sm">
                                            <i class="bi bi-envelope me-2"></i>Send Direct Email
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Add fade-in animation on scroll
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('fade-in-up');
        }
    });
}, observerOptions);

// Observe all product cards
document.querySelectorAll('.product-card').forEach(card => {
    observer.observe(card);
});

// Product card hover effects
document.querySelectorAll('.product-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-8px)';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
    });
});

// Smart Search Functionality
const searchBox = document.getElementById('searchBox');
const searchResults = document.getElementById('searchResults');
const searchResultsContent = document.getElementById('searchResultsContent');
const clearSearchBtn = document.getElementById('clearSearch');
const originalProductsSection = document.querySelector('.row.g-4');
let searchTimeout;

// Search function with debouncing
function performSearch() {
    const query = searchBox.value.trim();
    
    if (query.length < 2) {
        hideSearchResults();
        return;
    }
    
    // Show loading state
    searchResults.style.display = 'block';
    searchResultsContent.innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Searching...</span>
            </div>
            <p class="mt-2 text-muted">Searching for "${query}"...</p>
        </div>
    `;
    
    // Hide original products
    originalProductsSection.style.display = 'none';
    
    // Perform AJAX search
    fetch(`/search_products?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            displaySearchResults(data, query);
        })
        .catch(error => {
            console.error('Search error:', error);
            searchResultsContent.innerHTML = `
                <div class="alert alert-danger" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    Search failed. Please try again.
                </div>
            `;
        });
}

// Display search results
function displaySearchResults(products, query) {
    if (products.length === 0) {
        searchResultsContent.innerHTML = `
            <div class="text-center py-5">
                <i class="bi bi-search text-muted" style="font-size: 4rem;"></i>
                <h4 class="text-muted mt-3">No products found</h4>
                <p class="text-muted">Try different keywords or check for typos</p>
                <button class="btn btn-primary" onclick="showAllProducts()">
                    <i class="bi bi-grid me-2"></i>Browse All Products
                </button>
            </div>
        `;
        return;
    }
    
    let resultsHtml = '<div class="row g-4">';
    
    products.forEach(product => {
        const isOutOfStock = product.type === 'key' && product.stock_count <= 0;
        const productImage = product.image ? product.image : '/static/no_image.svg';
        
        const stockInfo = product.type === 'key' ? 
            (product.stock_count > 0 ? 
                `<small class="text-success"><i class="bi bi-check-circle me-1"></i>${product.stock_count} available</small>` :
                `<small class="text-danger"><i class="bi bi-x-circle me-1"></i>Out of stock</small>`
            ) : 
            `<small class="text-info"><i class="bi bi-infinity me-1"></i>Digital copy</small>`;
            
        const buyButton = isOutOfStock ? 
            `<button class="btn btn-secondary w-100" disabled>
                <i class="bi bi-x-circle me-2"></i>Out of Stock
            </button>` :
            `<a href="/buy/${product.id}" class="btn btn-primary w-100">
                <i class="bi bi-cart-plus me-2"></i>Buy Now
            </a>`;
        
        resultsHtml += `
            <div class="col-lg-4 col-md-6">
                <div class="card h-100 product-card fade-in-up">
                    <div class="product-image">
                        <img src="${productImage}" class="card-img-top" alt="${product.name}" 
                             style="height: 200px; object-fit: cover;" 
                             onerror="this.src='/static/no_image.svg'">
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="card-title">${product.name}</h5>
                            <span class="badge bg-${product.type === 'key' ? 'primary' : 'success'}">
                                ${product.type === 'key' ? 'Key' : 'File'}
                            </span>
                        </div>
                        
                        <p class="card-text text-muted flex-grow-1">
                            ${product.description ? product.description.substring(0, 100) + '...' : 'No description available'}
                        </p>
                        
                        <div class="mt-auto">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="product-price">${product.price_dzd.toLocaleString()} DZD</span>
                                ${stockInfo}
                            </div>
                            
                            ${buyButton}
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    resultsHtml += '</div>';
    
    // Add search summary
    const summaryHtml = `
        <div class="alert alert-info mb-4" role="alert">
            <i class="bi bi-info-circle me-2"></i>
            Found <strong>${products.length}</strong> product${products.length !== 1 ? 's' : ''} matching "<strong>${query}</strong>"
        </div>
    `;
    
    searchResultsContent.innerHTML = summaryHtml + resultsHtml;
}

// Hide search results and show all products
function hideSearchResults() {
    searchResults.style.display = 'none';
    originalProductsSection.style.display = 'flex';
}

// Show all products (called from buttons)
function showAllProducts() {
    searchBox.value = '';
    hideSearchResults();
    searchBox.focus();
}

// Event listeners
searchBox.addEventListener('input', function() {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(performSearch, 300); // 300ms debounce
});

searchBox.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        showAllProducts();
    }
});

clearSearchBtn.addEventListener('click', showAllProducts);

// Focus search box on page load
document.addEventListener('DOMContentLoaded', function() {
    // Add subtle focus to search box after a short delay
    setTimeout(() => {
        searchBox.focus();
    }, 500);
});

// Make showAllProducts globally available
window.showAllProducts = showAllProducts;

// Category filtering functionality
document.querySelectorAll('.category-filter').forEach(button => {
    button.addEventListener('click', function() {
        const categoryId = this.getAttribute('data-category');
        
        // Update active button
        document.querySelectorAll('.category-filter').forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        
        // Filter products
        const productCards = document.querySelectorAll('#productsContainer .col-lg-4');
        productCards.forEach(card => {
            const productCategoryBadge = card.querySelector('.badge.bg-secondary');
            
            if (categoryId === 'all') {
                card.style.display = '';
            } else {
                // This is a simplified approach - in a real implementation,
                // you'd want to store category data in data attributes
                if (productCategoryBadge && productCategoryBadge.textContent.trim()) {
                    card.style.display = '';
                } else if (categoryId !== 'all') {
                    card.style.display = 'none';
                }
            }
        });
    });
});

// Contact Form Handling
const contactForm = document.getElementById('contactForm');
const contactAlert = document.getElementById('contactAlert');
const submitBtn = document.getElementById('submitBtn');

if (contactForm) {
    contactForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Show loading state
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Sending...';
        
        // Hide previous alerts
        contactAlert.classList.add('d-none');
        
        // Create FormData object
        const formData = new FormData(contactForm);
        
        // Submit form via AJAX
        fetch('/contact', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            // Show success/error message
            contactAlert.className = `alert ${data.success ? 'alert-success' : 'alert-danger'}`;
            contactAlert.innerHTML = data.message;
            contactAlert.classList.remove('d-none');
            
            if (data.success) {
                // Reset form on success
                contactForm.reset();
                
                // Scroll to alert
                contactAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        })
        .catch(error => {
            console.error('Contact form error:', error);
            contactAlert.className = 'alert alert-danger';
            contactAlert.innerHTML = '‚ùå Sorry, there was an error sending your message. Please try again.';
            contactAlert.classList.remove('d-none');
        })
        .finally(() => {
            // Reset button state
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="bi bi-send me-2"></i>Send Message';
        });
    });
}
</script>
{% endblock %}